<!-- TOC -->

- [MVP 矩阵推导](#mvp-矩阵推导)
  - [Model 矩阵](#model-矩阵)
    - [缩放矩阵](#缩放矩阵)
  - [$$](#)
    - [旋转矩阵](#旋转矩阵)
    - [位移矩阵](#位移矩阵)
  - [$$](#-1)
  - [View 矩阵](#view-矩阵)
  - [Perspective 矩阵](#perspective-矩阵)

<!-- /TOC -->

# MVP 矩阵推导

某物体上顶点 $V$ 在模型空间中坐标为 $(v_{x}, v_{y}, v_{z})$, 
该物体原点在世界空间中坐标为 $M\ (t_{x}, t_{y}, t_{z})$, 
沿 x, y, z 轴分别缩放了 $S_{x}, S_{y}, S_{z}$, 并绕某一轴$\vec{k}\ (k_x, k_y, k_z)$旋转了$\theta$ 角度, $\vec{k}$为单位向量

## Model 矩阵

------
### 缩放矩阵

缩放前 $V$ 坐标为$(v_x,v_y,v_z)$,缩放后坐标为$(S_x*v_x,S_y*v_y,S_z*v_z)$,易得对应矩阵为

$$
S=
\begin{bmatrix}

    S_{x} & 0 & 0 & 0 \\
    0 & S_{y} & 0 & 0 \\
    0 & 0 & S_{y} & 0 \\
    0 & 0 & 0 & 1 \\

\end{bmatrix}
$$
------
### 旋转矩阵

点 $V$ 沿某一轴旋转后的得到的点 $V_{rot}$ 的位置可通过罗德里格斯旋转公式求得：
$$
\vec{v_{rot}} = 
R\vec{v}=
\vec{v} \cos \theta + 
(\vec{k} \times \vec{v}) \sin\theta+
\vec{k}(\vec{k}\cdot\vec{v})(1-\cos\theta )
$$
其中，$R$ 为旋转变换矩阵，$\vec{k}$ 与 $\vec{v}$ 的叉乘可以转化为一反对称矩阵 $\vec{k_\times}$ 与 $\vec{v}$ 的乘积，其中$\vec{k_\times}$ (有些材料称之为dual matrix) 定义为
$$
\vec{k_\times} = \begin{bmatrix}
    0 & -k_z & k_y \\
    k_z & 0 & -k_x \\
    -k_y & k_x & 0 \\
\end{bmatrix}
$$
记 $\vec{v_\perp}$ 为 $\vec{v}$ 垂直于 $\vec{k}$ 的分量,记 $\vec{v_\parallel}$ 为 $\vec{v}$ 平行于 $\vec{k}$ 的分量,则有
$$
\vec{k}(\vec{k}\cdot\vec{v}) =  \vec{v_\parallel} = \vec{v}-\vec{v_\perp}
$$
又
$$\begin{aligned}
\vec{k} \times (\vec{k} \times \vec{v}) &= 
\vec{k_\times}\vec{k_\times}\vec{v}\\ &=
\begin{bmatrix}
    0 & -k_z & k_y \\
    k_z & 0 & -k_x \\
    -k_y & k_x & 0 \\
\end{bmatrix}
\begin{bmatrix}
    0 & -k_z & k_y \\
    k_z & 0 & -k_x \\
    -k_y & k_x & 0 \\
\end{bmatrix}
\begin{bmatrix}
    v_x \\
    v_y \\
    v_z \\
\end{bmatrix} \\ &=
\begin{bmatrix}
    0 & -k_z & k_y \\
    k_z & 0 & -k_x \\
    -k_y & k_x & 0 \\
\end{bmatrix}
\begin{bmatrix}
    k_yv_z-k_zv_y \\
    k_zv_x-k_xv_z \\
    k_xv_y-k_yv_x \\
\end{bmatrix} \\ &=
\begin{bmatrix}
    k_xk_yv_y+k_xk_zv_z-k_y^2v_x-k_z^2v_x \\
    k_xk_yv_x+k_yk_zv_z-k_x^2v_y-k_z^2v_y \\
    k_xk_zv_x+k_yk_zv_y-k_x^2v_z-k_y^2v_z \\
\end{bmatrix} \\ &=
\begin{bmatrix}
    k_x^2v_x+k_xk_yv_y+k_xk_zv_z-v_x \\
    k_y^2v_y+k_xk_yv_x+k_yk_zv_z-v_y \\
    k_z^2v_z+k_xk_zv_x+k_yk_zv_y-v_z \\
\end{bmatrix} \\ &=
\begin{bmatrix}
    k_x(k_xv_x+k_yv_y+k_zv_z) \\
    k_y(k_xv_x+k_yv_y+k_zv_z) \\
    k_z(k_xv_x+k_yv_y+k_zv_z) \\
\end{bmatrix} -
\begin{bmatrix}
    v_x \\
    v_y \\
    v_z \\
\end{bmatrix} \\ &=
(k_xv_x+k_yv_y+k_zv_z)
\begin{bmatrix}
    k_x \\
    k_y \\
    k_z \\
\end{bmatrix} -
\begin{bmatrix}
    v_x \\
    v_y \\
    v_z \\
\end{bmatrix} \\ &=
(\vec{k} \cdot \vec{v}) \vec{k}-\vec{v} \\ &=
\vec{v_\parallel}-\vec{v} \\ &=
-\vec{v_\perp}
\end{aligned}
$$
所以
$$
\begin{aligned}
\vec{v_{rot}} = R\vec{v} &= 
\vec{v} \cos \theta + 
(\vec{k} \times \vec{v}) \sin\theta+
\vec{v_\parallel}(1-\cos\theta ) \\ &=
\vec{v} \cos \theta + 
(\vec{k} \times \vec{v}) \sin\theta+
(\vec{v}-\vec{v_\perp})(1-\cos\theta ) \\ &=
\vec{v} \cos \theta + 
(\vec{k} \times \vec{v}) \sin\theta+
[\vec{v}+\vec{k} \times (\vec{k} \times \vec{v})](1-\cos\theta ) \\ &=
\vec{v}+
(\vec{k} \times \vec{v}) \sin\theta+
\vec{k} \times (\vec{k} \times \vec{v})(1-\cos\theta ) \\ &=
[(1-\cos\theta ) \vec{k_\times}\vec{k_\times}+\vec{k_\times}+I]\vec{v} \\
R &= (1-\cos\theta ) \vec{k_\times}\vec{k_\times}+
\sin\theta\vec{k_\times}+
I
\end{aligned} 
$$

特殊情况下，当 $\vec{k}$ 为某一坐标轴时：
$$
\begin{aligned}
\vec{k} &= (1,0,0)^T \ \ \ 
R&=\begin{bmatrix}
    1 & 0 & 0 \\
    0 & \cos\theta & -\sin\theta \\
    0 & \sin\theta & \cos\theta \\
\end{bmatrix} \\
\vec{k} &= (0,1,0)^T \ \ \ 
R&=\begin{bmatrix}
    \cos\theta & 0 & \sin\theta \\
    0 & 1 & 0 \\
    -\sin\theta & 0 & \cos\theta \\
\end{bmatrix} \\
\vec{k} &= (0,0,1)^T \ \ \ 
R&=\begin{bmatrix}
    \cos\theta & -\sin\theta & 0 \\
    \sin\theta & \cos\theta & 0 \\
    0 & 0 & 1 \\
\end{bmatrix}
\end{aligned} 
$$

------
### 位移矩阵

由于位移变换不是线性变换。无法用三维矩阵的乘法运算来表示，所以引入齐次坐标，用
$$
\begin{bmatrix}
    x & y & z & \omega \\
\end{bmatrix}^T
$$
来表示一个三维坐标，其中 $\omega$ 不为零时，表示一个点，$\omega$ 为零时，表示一个向量。
则位移矩阵 $T$ 可表示为
$$
T = \begin{bmatrix}
    1 & 0 & 0 & t_x \\
    0 & 1 & 0 & t_y \\
    0 & 0 & 1 & t_z \\
    0 & 0 & 0 & 1 \\
\end{bmatrix}
$$

------

所以，顶点 $\vec{v}$ 在世界坐标中的顶点为
$$
v_w = TRSv
$$
------



## View 矩阵

## Perspective 矩阵
